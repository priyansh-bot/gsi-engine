<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gold Sentiment Index (GSI) - India</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .dial-container { aspect-ratio: 2 / 1; }
        .needle {
            transition: transform 1.5s cubic-bezier(0.68, -0.6, 0.32, 1.6);
            transform-origin: bottom center;
        }
        .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-5xl mx-auto space-y-8">
        <header class="text-center">
            <h1 class="text-5xl font-bold text-yellow-400 tracking-tight">Gold Sentiment Index</h1>
            <p class="text-gray-400 mt-2 text-lg">An automated sentiment analysis for the Indian gold market.</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-5 gap-8">
            
            <!-- Left Column: Dial -->
            <div class="lg:col-span-2 card rounded-2xl shadow-2xl p-6 flex flex-col items-center justify-center">
                <div class="w-full max-w-xs dial-container relative overflow-hidden">
                    <div class="absolute bottom-0 left-0 right-0 h-1/2 rounded-t-full" 
                         style="background-image: conic-gradient(from -90deg at 50% 100%, #ef4444 0%, #f97316 25%, #eab308 50%, #84cc16 75%, #22c55e 100%);">
                    </div>
                    <div class="absolute bottom-0 left-0 right-0 h-1/2 bg-gray-800 rounded-t-full" style="transform: scale(0.9);"></div>
                    <div class="absolute bottom-0 text-xs text-gray-400 flex justify-between w-full px-4">
                        <span>Sell</span>
                        <span>Hold</span>
                        <span>Buy</span>
                    </div>
                    <div id="needle" class="needle absolute bottom-1/2 left-1/2 h-1/2 w-1.5 bg-white rounded-full shadow-lg" style="transform: translate(-50%) rotate(0deg);"></div>
                    <div class="absolute bottom-0 left-1/2 transform -translate-x-1/2 bg-white h-4 w-4 rounded-full border-2 border-gray-800"></div>
                </div>
                <div id="gsi-display" class="text-center mt-4">
                    <p class="text-6xl font-bold text-white tracking-tighter">--%</p>
                    <p id="signal-text" class="text-3xl font-semibold text-gray-400 mt-1 transition-colors duration-500">Loading...</p>
                </div>
            </div>

            <!-- Right Column: Indicators -->
            <div class="lg:col-span-3 card rounded-2xl shadow-2xl p-6 md:p-8">
                <h2 class="text-3xl font-semibold text-yellow-400 border-b border-yellow-400/20 pb-3 mb-6">Indicator Breakdown</h2>
                <div id="indicators-list" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Indicators will be dynamically inserted here -->
                </div>
                 <div class="text-xs text-gray-500 pt-6 text-center">
                    Last Updated: <span id="last-updated">Loading...</span>
                </div>
            </div>
        </main>
    </div>

    <script>
        // --- FINAL FRONTEND LOGIC (Phase 2 Closure) ---
        const indicatorWeights = {
            globalGold: 3, usdInr: 2, indianGold: 2,
            nifty50: 2, season: 1, monsoon: 1, us10yBond: 3,
        };

        function getSeasonalScore() {
            const now = new Date(); const month = now.getMonth() + 1;
            const festivals = [ { name: "Akshaya Tritiya", month: 5, day: 10 }, { name: "Dhanteras", month: 10, day: 29 } ];
            for (const festival of festivals) {
                const festivalDate = new Date(now.getFullYear(), festival.month - 1, festival.day);
                const diffDays = Math.ceil((festivalDate - now) / (1000 * 60 * 60 * 24));
                if (diffDays >= 0 && diffDays <= 7) return 2;
                if (diffDays > 7 && diffDays <= 30) return 1;
            }
            if (month === 12 || month === 1 || month === 2) return 2;
            return 0;
        }

        function getMonsoonScore() {
            const month = new Date().getMonth() + 1;
            if (month >= 6 && month <= 9) return 1; if (month >= 10 && month <= 12) return 1; return 0;
        }
        
        async function updateUI() {
            try {
                const response = await fetch('gsi-data.json?cachebust=' + new Date().getTime());
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                
                const priceSignals = data.signals;
                const rawData = data.rawData;
                const seasonSignal = getSeasonalScore();
                const monsoonSignal = getMonsoonScore();

                const allSignals = { ...priceSignals, season: seasonSignal, monsoon: monsoonSignal };
                
                let score = 0; let maxPossibleScore = 0;
                for (const key in indicatorWeights) {
                    const signalValue = allSignals[key] || 0;
                    score += signalValue * indicatorWeights[key];
                    maxPossibleScore += (key === 'season' ? 2 : 1) * indicatorWeights[key];
                }

                const minPossibleScore = -maxPossibleScore + (2 * indicatorWeights.season); // Adjust for season which can't be negative
                const gsiPercentage = Math.round(((score - minPossibleScore) / (maxPossibleScore - minPossibleScore)) * 100);

                // --- UPDATE UI ELEMENTS ---
                document.getElementById('needle').style.transform = `translate(-50%) rotate(${-90 + (gsiPercentage * 1.8)}deg)`;
                document.querySelector('#gsi-display p:first-child').textContent = `${gsiPercentage}%`;
                
                let signal, color;
                if (gsiPercentage > 80) { signal = "Strong Buy"; color = "text-green-400"; }
                else if (gsiPercentage > 60) { signal = "Buy"; color = "text-green-500"; }
                else if (gsiPercentage > 40) { signal = "Hold"; color = "text-yellow-400"; }
                else if (gsiPercentage > 20) { signal = "Sell"; color = "text-orange-500"; }
                else { signal = "Strong Sell"; color = "text-red-500"; }
                const signalTextEl = document.getElementById('signal-text');
                signalTextEl.textContent = signal;
                signalTextEl.className = `text-3xl font-semibold ${color} mt-1 transition-colors duration-500`;

                const indicatorsList = document.getElementById('indicators-list');
                indicatorsList.innerHTML = '';
                const indicatorNames = {
                    globalGold: "Global Gold", usdInr: "USD/INR", indianGold: "Indian Gold (GoldBees)",
                    nifty50: "NIFTY 50", us10yBond: "US 10Y Bond", season: "Festivals", monsoon: "Monsoon"
                };

                const rawDataKeys = {
                    globalGold: 'globalGold', usdInr: 'usdInr', indianGold: 'goldBee',
                    nifty50: 'nifty50', us10yBond: 'us10yBond'
                };

                for (const key in indicatorNames) {
                    const signalValue = allSignals[key];
                    const rawKey = rawDataKeys[key];
                    const rawValue = rawData[rawKey];

                    let rawColor = "text-gray-400";
                    let rawArrow = "—";
                    if (typeof rawValue === 'number') {
                        if (rawValue > 0.01) { rawColor = "text-green-400"; rawArrow = "▲"; }
                        if (rawValue < -0.01) { rawColor = "text-red-400"; rawArrow = "▼"; }
                    }
                    // Handle date-based signals which don't have raw data
                    if (key === 'season' || key === 'monsoon') {
                        if(signalValue > 0) { rawColor = "text-green-400"; rawArrow = "▲"; }
                        else { rawColor = "text-yellow-400"; rawArrow = "—"; }
                    }

                    const div = document.createElement('div');
                    div.className = 'bg-gray-800 p-4 rounded-lg flex justify-between items-center ring-1 ring-white/10';
                    div.innerHTML = `
                        <div class="flex items-center">
                            <span class="font-semibold text-gray-200">${indicatorNames[key]}</span>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-lg ${rawColor}">${rawArrow}</div>
                            <div class="text-xs text-gray-500">${typeof rawValue === 'number' ? rawValue.toFixed(2) + '%' : 'N/A'}</div>
                        </div>
                    `;
                    indicatorsList.appendChild(div);
                }

                document.getElementById('last-updated').textContent = new Date(data.lastUpdated).toLocaleString();

            } catch (error) {
                console.error("Failed to load GSI data:", error);
                document.getElementById('signal-text').textContent = "Error Loading Data";
            }
        }
        
        updateUI();
    </script>
</body>
</html>


